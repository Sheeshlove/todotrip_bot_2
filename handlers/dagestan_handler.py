"""
Dagestan command handler for ToDoTrip Telegram bot
Обработчик команды dagestan для Telegram бота ToDoTrip
"""

from telebot import TeleBot, types

def register_dagestan_handler(bot: TeleBot):
    """
    Register the dagestan command handler
    Зарегистрировать обработчик команды dagestan
    
    Args:
        bot: TeleBot instance
        bot: Экземпляр TeleBot
    """
    # Dictionary to store button texts and their responses
    # Словарь для хранения текстов кнопок и их ответов
    button_responses = {
        'Я никого не знаю и боюсь ехать один': (
            'Не переживайте, что вы никого не знаете – мы специально заботимся о том, чтобы вам было легко и комфортно. '
            'До поездки мы запускаем дружеский чат в Telegram, где все участники смогут заранее познакомиться, задать вопросы и просто пообщаться. '
            'Во время путешествия мы проводим веселые тимбилдинговые активности: игры, квесты и совместные задания, которые помогают сломать лёд и начать общение.\n\n'
            'Наш опыт показывает: даже если вы отправляетесь в поездку совершенно один, уже к первому вечеру вы найдёте, о чем поговорить с остальными, '
            'а к концу тура – обзаведётесь новыми друзьями. Комфорт и тёплая атмосфера – наш главный приоритет, поэтому мы создаём все условия, '
            'чтобы вы чувствовали себя в команде с самого начала. Вам точно не о чем волноваться: мы уже не раз видели, как незнакомцы превращаются в сплочённую компанию к концу путешествия.'
        ),
        'Поездка слишком дорогая': (
            'Понимаем ваше беспокойство — бюджет не резиновый. Однако в стоимость включено всё, чтобы вы ни о чём не думали: '
            'трансфер из города и по горам, уютное жильё, питание, услуги опытных гидов, все экскурсии, прогулки на SUPaх и катерах, '
            'а ещё мастер-классы по традиционным дагестанским промыслам и образовательная программа по предпринимательству. '
            'Если посчитать это отдельно, то получится дороже: дешёвые варианты обычно оборачиваются незапланированными расходами '
            'на такси, уличную еду, непредвиденные сервисы и т. д. Мы же заботимся о вашем комфорте и безопасности, поэтому '
            'продумываем каждый этап поездки «под ключ».\n\n'
            'Кроме того, мы предлагаем гибкие условия оплаты: можно внести предоплату и разделить остаток суммы на несколько месяцев, '
            'а при регистрации группой (от двух человек) действует скидка. И не забывайте: за эти деньги вы получите не просто маршрут, '
            'а возможность завести новых друзей, погрузиться в культуру Дагестана и сохранить яркие воспоминания на всю жизнь. '
            'Мы уверены, что такой опыт стоит вложений и оправдает себя многократно.'
        ),
        'Я боюсь обмана': (
            'Понимаем ваше беспокойство — в наше время действительно важно чувствовать, что вы сотрудничаете с надёжной организацией. '
            'Мы работаем на основании официальных документов: все программы поездки описаны в подробном договоре, где чётко прописаны '
            'ваши права, обязанности и условия возврата средств. Оплата производится через надёжные платёжные системы (банковский перевод, '
            'реквизиты, наличные), где вы всегда можете отследить транзакцию. Мы не просим переводить наличные третьим '
            'лицам или пользоваться сомнительными схемами. Мы сотрудничаем только с проверенными гостевыми домами, водителями и гидами '
            'в Дагестане. Все они имеют хорошие отзывы и соответствующие документы. Наши гиды — местные жители, которые знают регион '
            '«как свои пять пальцев» и дорожат своей репутацией, поэтому никогда не будут подводить клиентов. '
            'С нами уже ездили десятки студентов: мы собираем обратную связь и публикуем реальные отзывы на нашем сайте и в соцсетях. Вы можете связаться с бывшими участниками, чтобы они рассказали о своём опыте. Кроме того, вы можете задать вопросы тем, кто уже вернулся из поездки, задать им конкретные вопросы и оценить, как всё прошло на самом деле. '
            'Если у вас остались сомнения, просто напишите нам — мы с удовольствием предоставим дополнительную информацию, познакомим вас с участниками прошлых туров или устроим короткую видеовстречу. Наша цель — чтобы вы чувствовали себя спокойно и уверенно: мы не просто продаём тур, мы создаём дружескую команду, где каждому важно ваше доверие и комфорт.'
        ),
        'А в Дагестане безопасно?': ('Дагестан в целом безопасен для туристов, особенно когда вы путешествуете организованно, с опытным гидом и в компании группы. Основные риски (погода, перепады высот, длительные переезды по серпантинам) мы заранее прогнозируем и минимизируем. Если следовать рекомендациям и не отклоняться от программы, вам не о чём беспокоиться: вы увидите живописные горы, познакомитесь с гостеприимными людьми и получите массу ярких впечатлений. В случае непредвиденных ситуаций мы готовы поддержать вас 24/7.'), 
        'Что мы там увидим?': ('Мы увидим горы, увидим каньоны, аулы, озёра, Каспийское море, и многое другое. Подробнее можно посмотреть на сайте https://todotrip.pro/programme'),
        'В чём смысл предпринимательской программы?': (
            'Сегодня всё больше молодых людей понимают: работать «за зарплату» значит рано или поздно столкнуться с потолком дохода и ограничениями карьерного роста. '
            'Стандартный офисный путь для зумеров перестаёт быть привлекательным: зарплаты растут медленно, а перспективы часто связаны с бесконечными «бюрократическими» лестницами. '
            'Именно поэтому тренд на предпринимательство среди студентов и молодых специалистов крепнет как никогда — и наша предпринимательская программа в туре даёт реальный старт тем, '
            'кто хочет обойти «заработные ограничения» и сразу брать ответственность за собственный проект.\n\n'
            'Что вы получите в рамках программы?\n\n'
            '1. Прозрачные кейсы о преодолении «потолков» наёмных сотрудников.\n'
            'Наши спикеры — ребята, которые раньше работали «по найму», столкнулись с фиксированными рамками заработных планок и ушли в свой бизнес. '
            'Они расскажут, как правильно рассчитать риски, найти клиентов и минимизировать «страх потерять стабильность». '
            'Вы узнаете, с чего начать, когда банковский перевод «жмёт», а глаза «требуют» более амбициозных планов.\n\n'
            '2. Генерация прибыльных бизнес-идей без лишних рисков.\n'
            'Вместе с опытными предпринимателями вы пройдёте серию практических упражнений: от быстрых brainstorm-сессий до отработки простых метрик (CPO, LTV, ROI). '
            'Это не просто «теория», а реальные алгоритмы: как с нуля провести аналитику рынка, оценить конкуренцию и обозначить свою нишу. '
            'Все методики проверены на начинаниях студентов, которые спустя пару месяцев уже показывали первые продажи.\n\n'
            '3. Мастер-майнд группы: «ускоренная обратная связь» и идейный обмен.\n'
            'Мы объединим вас в маленькие команды (4–6 человек), где каждый сможет представить свою идею и сразу услышать комментарии: '
            '«что работает», «где слабые места», «как сделать предложение более конкурентным». '
            'С учётом того, что зумеры привыкли к общению онлайн, формат живого лагеря в горах становится катализатором для быстрых инсайтов и выработки смелых решений.\n\n'
            '4. Нетворкинг с настоящими «сверстниками-предпринимателями».\n'
            'Очень часто молодым людям бывает сложно найти единомышленников, которые понимают специфику современных рынков, знают соцсети, венчурные гранты и краудфандинг. '
            'Наш тур объединяет студенческие стартапы, фрилансеров и начинающих руководителей маленьких компаний — в результате у вас появляется цепочка контактов: '
            'дизайнеры, маркетологи, программисты и даже первые потенциальные клиенты.\n\n'
            '5. Практические навыки: от финансового планирования до первых продаж.\n'
            'В рамках отдельных коротких воркшопов вы получите конкретные инструменты:\n'
            '• Как составить простой финансовый план, учитывая риски сезонного спроса или кредитную нагрузку.\n'
            '• Как сформулировать уникальное торговое предложение (УТП) и не теряться в океане конкурентов.\n'
            '• Как запустить социальные сети под свой проект так, чтобы получать подписчиков и первые лиды уже во время поездки.\n\n'
            '6. Вдохновение от атмосферы и примеры успешных сверстников.\n'
            'Мы специально собираемся в Дагестане не только ради красоты гор, но и чтобы вы прочувствовали дух свободы и независимости. '
            'Истории ребят, которые запускали стартапы прямо из палатки под звёздами, мотивируют двигаться вперёд даже в случае первых неудач. '
            'Такая «offline-перезагрузка» помогает выйти из рамок привычного мышления и посмотреть на свой потенциал без оглядки на потолок «обычной» зарплаты.'
        ),
        'Как добираться до Дагестана?': (
            'Трансфер в регион и из него не входит в путёвку, поскольку участники нашей группы едут из разных городов. Вы можете самостоятельно добраться до Махачкалы любым удобным способом — главное, чтобы вы оказались в точке старта тура 7 июля. Планируйте прилёт или прибытие на несколько дней раньше, чтобы иметь запас времени на непредвиденные задержки. '
            'Самыми распространёнными вариантами являются авиаперелёт до аэропорта «Уйташ», поезд до железнодорожного вокзала Махачкалы, междугородний автобус или карпулинг, а также поездка на личном автомобиле. Авиарейс — самый быстрый способ, но билеты лучше брать заранее. Поезд займёт больше суток, зато стоит дешевле и позволяет взять с собой больше багажа; автобусные маршруты подходят, если вы готовы к длительной дороге; а совместная поездка на машине (BlaBlaCar и аналогичные сервисы) сочетает относительный комфорт и экономию. '
            'Рекомендуем бронировать билеты минимум за 3–4 недели до начала тура и стараться прибыть не позднее 5–6 июля. Обсудите в общем чате участников возможность совместного трансфера из аэропорта или вокзала — это поможет сэкономить и добраться вместе.'
        ),
        'Какая цена поездки и что в неё входит?': (
            'Стоимость поездки — 56 750 рублей, и если вы регистрируетесь по чьему-то промокоду, не забудьте указать его при записи (https://todotrip.pro/#zapis) — так вы получите свою скидку. '
            'В путешествие уже включено всё самое важное: уютное проживание в нескольких отелях, увлекательные экскурсии по всем уголкам Дагестана, мастер-классы и наша яркая программа от Клуба Предпринимателей. Подробности можно узнать на сайте https://todotrip.pro/ или просто поболтать с нашим супергероем Алексеем (@insendro) — он будет рядом с вами на протяжении всей поездки и с радостью ответит на все вопросы.'
        ),
        'Что делать, если я отравлюсь местной едой или сломаю ногу?': (
            'Не волнуйтесь: в группе всегда есть аптечка с базовыми препаратами (для отравлений и обезболивания), а гид оперативно окажет первую помощь и доставит вас в ближайший фельдшерский пункт или больницу. Если понадобится, организуем скорую помощь или транспорт до Махачкалы. '
            'Не забудьте взять страховой полис – в Дагестане клиники принимают российские страховки, и всё будет покрыто.'
        ),
        'Как подготовиться к поездке?': (
            'Возьмите документы: паспорт, страховой полис. Приготовьте лёгкую одежду для жарких дней и тёплую кофту или куртку на вечера, надёжную обувь для трекинга и дождевик. Не забудьте взять с собой солнцезащитные очки и крем, минимальную аптечку (жаропонижающее, обезболивающее, средства от расстройства желудка) и личные лекарства. Зарядный Power Bank пригодится, так как вне отеля зарядиться будет трудно.'
        ),
    }

    @bot.message_handler(commands=['dagestan'])
    def send_dagestan(message):
        """
        Handle /dagestan command
        Обработать команду /dagestan
        """
        # Create welcome message with link
        # Создаем приветственное сообщение со ссылкой
        welcome_text = (
            "Тут мы постараемся ответить на основные вопросы по нашему туру в Дагестан, "
            "который состоится 7-11 июля. С основной программой вы можете ознакомиться по ссылке "
            "https://todotrip.pro/\n\n"
            "Если у вас есть какие-то сомнения или вопросы, на которые вы не можете найти ответ, то обязательно пишите Алексею @insendro"
        )

        # Create keyboard with 10 buttons
        # Создаем клавиатуру с 10 кнопками
        markup = types.ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=True)
        
        # Create buttons using the dictionary keys
        # Создаем кнопки используя ключи словаря
        buttons = [types.KeyboardButton(text) for text in button_responses.keys()]
        
        # Add buttons to keyboard in pairs
        # Добавляем кнопки на клавиатуру парами
        for i in range(0, len(buttons), 2):
            if i + 1 < len(buttons):
                markup.add(buttons[i], buttons[i + 1])
            else:
                markup.add(buttons[i])

        # Send message with keyboard
        # Отправляем сообщение с клавиатурой
        bot.send_message(
            message.chat.id,
            welcome_text,
            reply_markup=markup,
            parse_mode='HTML'
        )

    @bot.message_handler(func=lambda message: message.text in button_responses.keys())
    def handle_button_click(message):
        """
        Handle button clicks
        Обработать нажатия на кнопки
        """
        # Get response for the clicked button
        # Получаем ответ для нажатой кнопки
        response = button_responses[message.text]
        
        # Send response
        # Отправляем ответ
        bot.reply_to(message, response) 
